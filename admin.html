<!DOCTYPE html>
<html>
<head>
  <title>ระบบจัดการห้องพัก - Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .summary-card { border-radius: 10px; padding: 20px; margin-bottom: 20px; color: white; }
    .total-rooms { background: #3498db; }
    .available-rooms { background: #2ecc71; }
    .booked-rooms { background: #e74c3c; }
  </style>
</head>
<body>
  <div class="container mt-4">
    <h1 class="text-center mb-4">ระบบจัดการห้องพัก (Admin)</h1>
    
    <div class="row">
      <div class="col-md-4">
        <div class="summary-card total-rooms">
          <h3>ห้องทั้งหมด</h3>
          <h2 id="totalRooms">0</h2>
        </div>
      </div>
      <div class="col-md-4">
        <div class="summary-card available-rooms">
          <h3>ห้องว่าง</h3>
          <h2 id="availableRooms">0</h2>
        </div>
      </div>
      <div class="col-md-4">
        <div class="summary-card booked-rooms">
          <h3>ห้องถูกจอง</h3>
          <h2 id="bookedRooms">0</h2>
        </div>
      </div>
    </div>
    
    <h2 class="mt-4">การจองล่าสุด</h2>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>ห้อง</th>
          <th>ผู้จอง</th>
          <th>วันที่เข้าพัก</th>
          <th>วันที่ออก</th>
        </tr>
      </thead>
      <tbody id="recentBookings">
        <!-- ข้อมูลการจองล่าสุดจะแสดงที่นี่ -->
      </tbody>
    </table>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbyRagha8huoVqVsYYEtP8qgYtKSr_Qtwjl7EpLTrTytwy1JL8Kns4t4CRk8vhhEr5Imkg/exec';
    
    // โหลดข้อมูลสรุป
    async function loadSummary() {
      try {
        const response = await fetch(`${API_URL}?path=admin/summary`);
        const data = await response.json();
        
        document.getElementById('totalRooms').textContent = data.total_rooms;
        document.getElementById('availableRooms').textContent = data.available_rooms;
        document.getElementById('bookedRooms').textContent = data.booked_rooms;
        
        const bookingsTable = document.getElementById('recentBookings');
        bookingsTable.innerHTML = '';
        
        data.recent_bookings.forEach(booking => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${booking.room_id}</td>
            <td>${booking.customer_name}</td>
            <td>${new Date(booking.check_in).toLocaleDateString()}</td>
            <td>${new Date(booking.check_out).toLocaleDateString()}</td>
          `;
          bookingsTable.appendChild(row);
        });
      } catch (error) {
        console.error('Error loading summary:', error);
        alert('ไม่สามารถโหลดข้อมูลสรุปได้');
      }
    }
    
    // โหลดข้อมูลเมื่อหน้าเว็บโหลดเสร็จ
    window.onload = loadSummary;
    
    // รีเฟรชข้อมูลทุก 30 วินาที
    setInterval(loadSummary, 30000);
  </script>
</body>
</html>